<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000000;
            color: #ffff00;
            font-family: 'Arial', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            padding: 20px;
        }

        .chat-header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid #ffff00;
            margin-bottom: 20px;
        }

        .chat-header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .chat-header p {
            opacity: 0.8;
            font-size: 0.9em;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px 0;
            scroll-behavior: smooth;
        }

        .message {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            max-width: 80%;
            position: relative;
        }

        .user-message {
            background-color: #333300;
            margin-left: auto;
            border: 1px solid #ffff00;
        }

        .bot-message {
            background-color: #111111;
            border: 1px solid #ffff00;
            margin-right: auto;
        }

        .message-content {
            margin-bottom: 10px;
        }

        .suggestions {
            margin-top: 15px;
        }

        .suggestion-button {
            background-color: #ffff00;
            color: #000000;
            border: none;
            padding: 8px 12px;
            margin: 5px 5px 5px 0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .suggestion-button:hover {
            background-color: #cccc00;
            transform: translateY(-1px);
        }

        .feedback-buttons {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        .feedback-btn {
            background: none;
            border: 1px solid #ffff00;
            color: #ffff00;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .feedback-btn:hover {
            background-color: #ffff00;
            color: #000000;
        }

        .feedback-btn.active {
            background-color: #ffff00;
            color: #000000;
        }

        .input-container {
            display: flex;
            gap: 10px;
            padding: 20px 0;
            border-top: 2px solid #ffff00;
        }

        .chat-input {
            flex: 1;
            background-color: #111111;
            border: 2px solid #ffff00;
            color: #ffff00;
            padding: 12px;
            border-radius: 5px;
            font-size: 1em;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.3);
        }

        .send-button {
            background-color: #ffff00;
            color: #000000;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .send-button:hover {
            background-color: #cccc00;
            transform: translateY(-1px);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            padding: 15px;
            font-style: italic;
            opacity: 0.7;
        }

        .typing-dots {
            display: inline-block;
        }

        .typing-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        @media (max-width: 600px) {
            .chat-container {
                padding: 10px;
            }
            
            .message {
                max-width: 95%;
            }
            
            .chat-header h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>游뱄 Chatbot</h1>
            <p>St칛ll dina fr친gor s친 hj칛lper jag dig!</p>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message bot-message">
                <div class="message-content">
                    Hej! Jag 칛r din chatbot. Vad kan jag hj칛lpa dig med idag?
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <span class="typing-dots">Chatbot skriver</span>
        </div>

        <div class="input-container">
            <input type="text" class="chat-input" id="chatInput" placeholder="Skriv din fr친ga h칛r..." maxlength="500">
            <button class="send-button" id="sendButton">Skicka</button>
        </div>
    </div>

    <script>
        // Kunskapsbas - l칛gg till dina fr친gor och svar h칛r
        const knowledgeBase = [
            {
                question: "vad heter du",
                answer: "Jag heter Chatbot och jag 칛r h칛r f칬r att hj칛lpa dig!",
                keywords: ["namn", "heter", "vem 칛r du"]
            },
            {
                question: "vad kan du g칬ra",
                answer: "Jag kan svara p친 fr친gor, ge information och hj칛lpa dig med olika 칛mnen. Fr친ga mig vad som helst!",
                keywords: ["kan", "g칬ra", "hj칛lpa", "funktioner"]
            },
            {
                question: "hur m친r du",
                answer: "Tack f칬r att du fr친gar! Som en chatbot m친r jag alltid bra och 칛r redo att hj칛lpa dig.",
                keywords: ["m친r", "k칛nner", "hur har du det"]
            },
            {
                question: "vad 칛r klockan",
                answer: "Jag kan inte se exakt tid, men du kan kolla klockan p친 din enhet. Beh칬ver du hj칛lp med n친got annat?",
                keywords: ["tid", "klockan", "n칛r"]
            },
            {
                question: "tack",
                answer: "S친 sn칛ll du 칛r! Det var s친 lite s친. 츿r det n친got mer jag kan hj칛lpa dig med?",
                keywords: ["tack", "tackar", "sn칛ll"]
            }
        ];

        // F칬rslag n칛r ingen matchning hittas
        const suggestions = [
            "Vad kan du g칬ra?",
            "Vem 칛r du?",
            "Kan du hj칛lpa mig?",
            "Ber칛tta n친got intressant",
            "Hur fungerar du?"
        ];

        // Chatbot-klass
        class Chatbot {
            constructor() {
                this.chatMessages = document.getElementById('chatMessages');
                this.chatInput = document.getElementById('chatInput');
                this.sendButton = document.getElementById('sendButton');
                this.typingIndicator = document.getElementById('typingIndicator');
                
                this.initEventListeners();
            }

            initEventListeners() {
                this.sendButton.addEventListener('click', () => this.sendMessage());
                this.chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendMessage();
                    }
                });

                // Auto-resize input och fokus
                this.chatInput.focus();
            }

            async sendMessage() {
                const message = this.chatInput.value.trim();
                if (!message) return;

                // Visa anv칛ndarens meddelande
                this.addMessage(message, 'user');
                this.chatInput.value = '';
                this.sendButton.disabled = true;

                // Visa typing indicator
                this.showTyping();

                // Simulera t칛nketid
                await this.delay(1000 + Math.random() * 1000);

                // Hitta svar
                const response = this.findBestMatch(message);
                
                this.hideTyping();
                this.addMessage(response.answer, 'bot', response.suggestions, response.showFeedback);
                this.sendButton.disabled = false;
                this.chatInput.focus();
            }

            addMessage(content, sender, suggestions = null, showFeedback = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}-message`;

                let messageHTML = `<div class="message-content">${content}</div>`;

                // L칛gg till f칬rslag om det finns
                if (suggestions && suggestions.length > 0) {
                    messageHTML += '<div class="suggestions">';
                    suggestions.forEach(suggestion => {
                        messageHTML += `<button class="suggestion-button" onclick="chatbot.handleSuggestion('${suggestion}')">${suggestion}</button>`;
                    });
                    messageHTML += '</div>';
                }

                // L칛gg till feedback-knappar f칬r bot-meddelanden
                if (sender === 'bot' && showFeedback) {
                    messageHTML += `
                        <div class="feedback-buttons">
                            <button class="feedback-btn" onclick="chatbot.handleFeedback(this, 'positive')">游녨 Bra</button>
                            <button class="feedback-btn" onclick="chatbot.handleFeedback(this, 'negative')">游녩 D친ligt</button>
                        </div>
                    `;
                }

                messageDiv.innerHTML = messageHTML;
                this.chatMessages.appendChild(messageDiv);
                this.scrollToBottom();
            }

            findBestMatch(userMessage) {
                const normalizedInput = this.normalizeText(userMessage);
                let bestMatch = null;
                let bestScore = 0;

                // S칬k efter b칛sta matchning
                knowledgeBase.forEach(item => {
                    const questionScore = this.calculateSimilarity(normalizedInput, this.normalizeText(item.question));
                    
                    // Kolla 칛ven keywords
                    let keywordScore = 0;
                    item.keywords.forEach(keyword => {
                        if (normalizedInput.includes(this.normalizeText(keyword))) {
                            keywordScore += 0.8;
                        }
                    });

                    const totalScore = Math.max(questionScore, keywordScore);

                    if (totalScore > bestScore && totalScore > 0.3) {
                        bestScore = totalScore;
                        bestMatch = item;
                    }
                });

                if (bestMatch) {
                    return {
                        answer: bestMatch.answer,
                        suggestions: null,
                        showFeedback: true
                    };
                } else {
                    // Ingen bra matchning hittades
                    const randomSuggestions = this.getRandomSuggestions(3);
                    return {
                        answer: "Hmm, jag 칛r inte s칛ker p친 vad du menar. H칛r 칛r n친gra saker du kan fr친ga om:",
                        suggestions: randomSuggestions,
                        showFeedback: false
                    };
                }
            }

            calculateSimilarity(str1, str2) {
                // Enkel similarity-algoritm baserad p친 gemensamma ord
                const words1 = str1.split(' ').filter(word => word.length > 2);
                const words2 = str2.split(' ').filter(word => word.length > 2);
                
                if (words1.length === 0 || words2.length === 0) return 0;

                let matches = 0;
                words1.forEach(word1 => {
                    words2.forEach(word2 => {
                        if (word1.includes(word2) || word2.includes(word1)) {
                            matches++;
                        }
                    });
                });

                return matches / Math.max(words1.length, words2.length);
            }

            normalizeText(text) {
                return text.toLowerCase()
                    .replace(/[친칛]/g, 'a')
                    .replace(/칬/g, 'o')
                    .replace(/[^\w\s]/g, '')
                    .trim();
            }

            getRandomSuggestions(count) {
                const shuffled = [...suggestions].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count);
            }

            handleSuggestion(suggestion) {
                this.chatInput.value = suggestion;
                this.sendMessage();
            }

            handleFeedback(button, type) {
                // Inaktivera alla feedback-knappar i samma grupp
                const feedbackGroup = button.parentElement;
                const buttons = feedbackGroup.querySelectorAll('.feedback-btn');
                buttons.forEach(btn => {
                    btn.classList.remove('active');
                    btn.disabled = true;
                });

                // Aktivera den klickade knappen
                button.classList.add('active');
                
                // H칛r kan du spara feedback-data
                console.log(`Feedback: ${type}`);
                
                // Visa tack-meddelande
                setTimeout(() => {
                    const thankYou = document.createElement('div');
                    thankYou.textContent = type === 'positive' ? 'Tack f칬r din positiva feedback!' : 'Tack f칬r din feedback, jag ska f칬rs칬ka bli b칛ttre!';
                    thankYou.style.fontSize = '0.8em';
                    thankYou.style.opacity = '0.7';
                    thankYou.style.marginTop = '5px';
                    feedbackGroup.appendChild(thankYou);
                }, 300);
            }

            showTyping() {
                this.typingIndicator.style.display = 'block';
                this.scrollToBottom();
            }

            hideTyping() {
                this.typingIndicator.style.display = 'none';
            }

            scrollToBottom() {
                setTimeout(() => {
                    this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
                }, 100);
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Starta chatboten
        const chatbot = new Chatbot();
    </script>
</body>
</html>
